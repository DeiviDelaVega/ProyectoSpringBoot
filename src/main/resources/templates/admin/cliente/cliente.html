<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<title>Listado de Clientes</title>

	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

	<link rel="stylesheet" th:href="@{/css/Cliente.css}" />

</head>

<body>
	<nav th:replace="admin/HeaderNavAdministrador :: nav"></nav>
	<br>
	<div class="list-clientes-container container py-4">
		<h2 class="section-title mb-3"><strong>Listado de Clientes</strong></h2>

		<br>
		<div class="d-flex mb-3" style="gap: 16px;">
			<button id="toggleFiltrosBtn" class="btn btn-outline-secondary px-4 py-2 fs-6" onclick="toggleFiltros()">
				<i class="fa fa-sliders-h me-2"></i> Filtros
			</button>
		</div>

		<div id="filtrosForm" style="display: none;">
			<form th:action="@{/admin/cliente}" method="get" class="filtro-container">
				<div class="form-row">
					<div class="col-md-6 d-flex align-items-center mb-2" style="margin-left: 23px">
						<label class="control-label mr-2" style="width: 300px;">Apellido o Documento</label>
						<input type="text" name="filtro" placeholder="Buscar Apellido o Documento" th:value="${filtro}"
							class="form-control" />
					</div>
				</div>

				<div class="d-flex mt-3" style="margin-left: 23px">
					<button type="submit" class="btn btn-dark">Buscar</button>
					<a href="/admin/cliente" class="btn btn-secondary ms-2" style="margin-left: 8px">Limpiar</a>
				</div>

			</form>
		</div>

		<table class="table table-striped align-middle">
			<thead class="table-dark">
				<tr>
					<th>ID</th>
					<th>Nombre</th>
					<th>Apellido</th>
					<th>N.º Documento</th>
					<th>Dirección</th>
					<th>Teléfono</th>
					<th>Correo</th>
					<th>Fecha de Registro</th>
					<th>Acciones</th>
				</tr>
			</thead>

			<tbody>
				<tr th:each="cliente : ${clientes}">
					<td th:text="${cliente.idCliente}"></td>
					<td th:text="${cliente.nombre}"></td>
					<td th:text="${cliente.apellido}"></td>
					<td th:text="${cliente.nroDocumento}"></td>
					<td th:text="${cliente.direccion}"></td>
					<td th:text="${cliente.numeroTelf}"></td>
					<td th:text="${cliente.correo}"></td>
					<td th:text="${#temporals.format(cliente.fechaRegistro,'dd/MM/yyyy HH:mm')}"></td>
					<td class="text-nowrap">
						<div class="d-flex gap-2">
							<a th:href="@{/admin/cliente/detalle/{id}(id=${cliente.idCliente})}" title="Detalle"
								class="text-decoration-none">
								<i class="fa fa-magnifying-glass icon-action"></i>
							</a>
							<a th:href="@{/admin/cliente/editar/{id}(id=${cliente.idCliente})}" title="Editar"
								class="text-decoration-none">
								<i class="fa fa-pen icon-action"></i>
							</a>
							<a href="#" th:data-id="${cliente.idCliente}" data-bs-toggle="modal"
								data-bs-target="#modalEliminar" title="Eliminar" class="text-decoration-none">
								<i class="fa fa-trash icon-action text-danger"></i>
							</a>
						</div>
					</td>
				</tr>
			</tbody>
		</table>

		<nav th:replace="Paginacion :: paginator"></nav>

	</div>

	<!-- Modal de confirmación -->
	<div class="modal fade" id="modalEliminar" tabindex="-1" aria-labelledby="modalEliminarLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="modalEliminarLabel">Confirmar Eliminación</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
						aria-label="Cerrar"></button>
				</div>
				<div class="modal-body">
					¿Estás segura de que deseas eliminar este cliente? Esta acción no se puede deshacer.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
					<a id="btnConfirmarEliminar" href="#" class="btn btn-danger">Eliminar</a>
				</div>
			</div>
		</div>
	</div>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<!-- JS sin procesar por Thymeleaf -->
	<script th:inline="javascript">
		const modalEliminar = document.getElementById('modalEliminar');
		modalEliminar.addEventListener('show.bs.modal', event => {
			const idCliente = event.relatedTarget.dataset.id;
			document.getElementById('btnConfirmarEliminar').href = '/admin/cliente/eliminar/' + idCliente;
		});
	</script>

	<script>
		function toggleFiltros() {
			const filtros = document.getElementById('filtrosForm');
			const boton = document.getElementById('toggleFiltrosBtn');

			if (filtros.style.display === 'none') {
				filtros.style.display = 'block';
				boton.textContent = 'Ocultar Filtros';
			} else {
				filtros.style.display = 'none';
				boton.innerHTML = '<i class="fa fa-sliders-h me-1"></i> Filtros';
			}
		}
	</script>

</body>

</html>