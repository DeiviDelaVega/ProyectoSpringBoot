<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
<meta charset="UTF-8">
<title>Mantenimiento de Inmuebles</title>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/MantInmueble.css}">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
	<nav th:replace="admin/HeaderNavAdministrador :: nav"></nav>
		<br>
<div class="list-clientes-container fade-in">
    <h2 class="section-title"><strong>MANTENIMIENTO DE INMUEBLES</strong></h2>
	<br>
    <div class="d-flex mb-3" style="gap: 16px;">
	    <a th:href="@{/admin/inmueble/inmuebles/nuevo}" class="btn btn-dark px-4 py-2 fs-6">
	        Agregar Inmueble
	    </a>
	
	    <button id="toggleFiltrosBtn" class="btn btn-outline-secondary px-4 py-2 fs-6">
	        <i class="fa fa-sliders-h me-2"></i> Filtros
	    </button>
	</div>

	<div id="filtrosForm" style="display: none;">
		<form th:action="@{/admin/inmueble/inmuebles}" method="get" class="filtro-container">
		    <div class="form-row row mb-3">
		        <div class="col-md-6 d-flex align-items-center">
		            <label class="control-label mr-2" style="width: 160px;">Descripción o Servicio</label>
		            <input type="text" name="filtro" placeholder="Buscar descripción o servicio"
		                   th:value="${filtro}" class="form-control" />
		        </div>
		        <div class="col-md-6 d-flex align-items-center">
				    <label class="control-label mr-2" style="width: 120px;">Disponibilidad</label>
				    <select name="disponibilidad" class="form-control">
				        <option value="" th:selected="${disponibilidad == null or disponibilidad == ''}">Seleccionar</option>
				        <option value="Si" th:selected="${disponibilidad == 'Si'}">Si</option>
				        <option value="No" th:selected="${disponibilidad == 'No'}">No</option>
				    </select>
				</div>
		    </div>
		    <div class="row">
		        <div class="col-md-6 d-flex align-items-center mb-2">
				    <label class="control-label mr-2" style="width: 120px;">Administrador</label>
				    <select name="adminId" class="form-control" style="margin-left: 59px;">
				        <option value="" th:selected="${adminId == null or adminId == ''}">Seleccionar</option>
				        <option th:each="admin : ${administradores}"
				                th:value="${admin.id}"
				                th:text="${admin.nombre + ' ' + admin.apellido}"
				                th:selected="${adminId != null and admin.id == adminId}">
				        </option>
				    </select>
				</div>
		        <div class="col-md-6 d-flex align-items-center mb-2">
		            <button type="submit" class="btn btn-dark mr-2" style="margin-left: 17px;">Buscar</button>
		            <a href="/admin/inmueble/inmuebles" class="btn btn-secondary">Limpiar</a>
		        </div>
		    </div>
		</form>
	</div>
	
    <table class="table">
        <thead>
            <tr>
                <th class="text-center align-middle">ID Inmueble</th>
                <th class="text-center align-middle">Nombre</th>
                <th class="text-center align-middle">Capacidad</th>
                <th class="text-center align-middle">Servicios Incluidos</th>
                <th class="text-center align-middle">Disponibilidad</th>
                <th class="text-center align-middle">Precio Por Noche</th>
                <th class="text-center align-middle">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="inmueble : ${inmuebles}">
                <td th:text="${inmueble.id}">ID Inmueble</td>
                <td th:text="${inmueble.nombre}">Nombre</td>
                <td th:text="${inmueble.capacidad}">Capacidad</td>
                <td th:text="${inmueble.serviciosIncluidos}">Servicios Incluidos</td>
                <td th:text="${inmueble.disponibilidad}">Disponibilidad</td>
                <td th:text="${inmueble.precioPorNoche}">Precio Por Noche</td>
                <td>
                    <a th:href="@{/admin/inmueble/inmuebles/detalle/{id}(id=${inmueble.id})}" title="Detalles">
                        <i class="fa fa-magnifying-glass icon-action"></i>
                    </a>
                    <a th:href="@{/admin/inmueble/inmuebles/editar/{id}(id=${inmueble.id})}" title="Editar">
                        <i class="fa fa-pen icon-action"></i>
                    </a>
					<a href="javascript:void(0);"
					   th:onclick="'confirmarEliminacion(\'/admin/inmueble/inmuebles/' + ${inmueble.id} + '\')'"
					   title="Eliminar">
					    <i class="fa fa-trash icon-action text-danger"></i>
					</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(lista)}">
	            <td colspan="100%" class="text-center">
	                <span th:if="${!hayFiltros}" class="text-muted">No hay datos en la tabla de inmuebles</span>
	                <span th:if="${hayFiltros}" class="text-muted">No hay datos con los filtros seleccionados</span>
	            </td>
	        </tr>
        </tbody>
    </table>
    
    <script>
	    document.addEventListener("DOMContentLoaded", function () {
	        const filtros = document.getElementById("filtrosForm");
	        const boton = document.getElementById("toggleFiltrosBtn");
	
	        const visible = localStorage.getItem("filtrosVisibles") === "true";
	        filtros.style.display = visible ? "block" : "none";
	
	        boton.innerHTML = visible
	            ? 'Ocultar Filtros'
	            : '<i class="fa fa-sliders-h me-1"></i> Filtros';
	
	        boton.addEventListener("click", function () {
	            const currentlyVisible = filtros.style.display === "block";
	            filtros.style.display = currentlyVisible ? "none" : "block";
	            localStorage.setItem("filtrosVisibles", !currentlyVisible);
	            boton.innerHTML = !currentlyVisible
	                ? 'Ocultar Filtros'
	                : '<i class="fa fa-sliders-h me-1"></i> Filtros';
	        });
	    });

	    function confirmarEliminacion(url) {
	        Swal.fire({
	            title: '¿Estás seguro de eliminar este inmueble?',
	            text: "Esta acción no se puede deshacer",
	            icon: 'warning',
	            showCancelButton: true,
	            confirmButtonColor: '#d33',
	            cancelButtonColor: '#3085d6',
	            confirmButtonText: 'Sí, eliminar',
	            cancelButtonText: 'Cancelar'
	        }).then((result) => {
	            if (result.isConfirmed) {
	                window.location.href = url;
	            }
	        });
	    }
	</script>

    <nav th:replace="admin/inmueble/PaginacionInmueble :: paginatorInmueble"></nav>
</div>

<div th:if="${eliminado}">
    <script>
        Swal.fire({
            title: '¡Inmueble eliminado!',
            text: 'El inmueble se ha eliminado correctamente',
            icon: 'success',
            confirmButtonText: 'Aceptar'
        });
    </script>
</div>

<div id="estado-actualizacion" th:if="${actualizado != null}" th:attr="data-actualizado=${actualizado}"></div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const estadoDiv = document.getElementById("estado-actualizacion");
        if (estadoDiv) {
            const actualizado = estadoDiv.getAttribute("data-actualizado") === "true";
            if (actualizado) {
                Swal.fire({
                    title: '¡Actualizado!',
                    text: 'El inmueble se actualizó correctamente',
                    icon: 'success',
                    confirmButtonText: 'Aceptar'
                });
            } else {
                Swal.fire({
                    title: 'Error',
                    text: 'No se pudo actualizar el inmueble. Intente nuevamente',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                });
            }
        }
    });
</script>

<div id="estado-agregado" th:if="${agregado != null}" th:attr="data-agregado=${agregado}"></div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const divAgregado = document.getElementById("estado-agregado");
        if (divAgregado) {
            const agregado = divAgregado.getAttribute("data-agregado") === "true";
            if (agregado) {
                Swal.fire({
                    title: '¡Agregado!',
                    text: 'El inmueble se registró correctamente',
                    icon: 'success',
                    confirmButtonText: 'Aceptar'
                });
            }
        }
    });
</script>

<br>
</body>
</html>